# ─────────────────────────────────────────────────────────────────────────────
# MB-pol NVT equilibration
# 216 H2O  |  18.6258 × 18.6258 × 55.8775 Å
# Generated by mbx-water-slab-prep / gen_input.py
#
# IMPORTANT — this is an unequilibrated Packmol structure.
# Run for at least 1–2 ns before collecting any production data.
# Adjust EQUIL_STEPS below to extend the run if needed.
#
# Requires mbx.json in the same directory (also generated by this tool).
# ─────────────────────────────────────────────────────────────────────────────

units           real
atom_style      full
boundary        p p p
processors      * * * map xyz

read_data       water_slab_216H2O_rho1.0_z3x.data

pair_style      mbx 9.0
pair_coeff      * * 1 h2o 1 2 2 json mbx.json

# MBX handles all intra- and inter-molecular interactions.
# Bond/angle sections are present for special-bond exclusions only.
bond_style      none
angle_style     none

neighbor        2.0 bin
neigh_modify    every 1 delay 0 check yes

timestep        0.2        # fs

# ── Step 1: Energy minimisation ───────────────────────────────────────────────
# Relaxes residual close contacts from Packmol so that the MBX induced-dipole
# CG solver converges on the very first dynamics step.  The stopping criterion
# is loose — we only need the geometry to be free of catastrophic overlaps.

minimize        1.0e-4 1.0e-6 500 5000
reset_timestep  0

# ── Step 2: NVT equilibration ─────────────────────────────────────────────────
variable        T      equal  298.15
variable        Tdamp  equal  20.0   # ~100 × timestep (standard for MB-pol)
variable        EQUIL_STEPS equal 5000

thermo_style    custom step temp pe ke etotal press density cpu cpuremain
thermo          1000

dump            traj all custom 5000 traj_equil.lammpstrj &
                id mol type x y z xu yu zu vx vy vz
dump_modify     traj sort id flush yes

# Rolling restart pair — allows resuming from the most recent checkpoint
restart         50000 restart_equil.a restart_equil.b

fix             1 all nvt temp ${T} ${T} ${Tdamp}

run             ${EQUIL_STEPS}

# ── Finalise ──────────────────────────────────────────────────────────────────
unfix           1
undump          traj
write_data      equil_final.data
